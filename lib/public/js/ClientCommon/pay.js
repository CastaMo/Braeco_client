(function(){var d="2.0.6",c={}.hasOwnProperty,f=function(){},b={PINGPP_NOTIFY_URL:"https://api.pingxx.com/notify/charges/",UPACP_WAP_URL:"https://gateway.95516.com/gateway/api/frontTransReq.do",ALIPAY_WAP_URL:"http://wappaygw.alipay.com/service/rest.htm",UPMP_WAP_URL:"uppay://uppayservice/?style=token&paydata=",JDPAY_WAP_URL:"https://m.jdpay.com/wepay/web/pay",BFB_SUCCESS:'<html><head><meta name="VIP_BFB_PAYMENT" content="BAIFUBAO"></head><body></body></html>',YEEPAY_WAP_URL:"https://ok.yeepay.com/paymobile/api/pay/request",YEEPAY_WAP_TEST_URL:"http://mobiletest.yeepay.com/paymobile/api/pay/request",PINGPP_MOCK_URL:"http://sissi.pingxx.com/mock.php"},a={alipay_wap:"alipay_wap",upmp_wap:"upmp_wap",upacp_wap:"upacp_wap",bfb_wap:"bfb_wap",wx_pub:"wx_pub",yeepay_wap:"yeepay_wap",jdpay_wap:"jdpay_wap"};f.prototype={version:d,_resultCallback:undefined,_jsApiParameters:{},_debug:false,_signature:undefined,createPayment:function(r,s,i,h){if(typeof s=="function"){this._resultCallback=s}if(typeof i!="undefined"){this._signature=i}if(typeof h=="boolean"){this._debug=h}var o;if(typeof r=="string"){try{o=JSON.parse(r)}catch(l){this._innerCallback("fail",this._error("json_decode_fail"));return}}else{o=r}if(typeof o=="undefined"){this._innerCallback("fail",this._error("json_decode_fail"));return}if(!c.call(o,"id")){this._innerCallback("fail",this._error("invalid_charge","no_charge_id"));return}if(!c.call(o,"channel")){this._innerCallback("fail",this._error("invalid_charge","no_channel"));return}var n=o["channel"];if(!c.call(o,"credential")){this._innerCallback("fail",this._error("invalid_charge","no_credential"));return}if(!o["credential"]){this._innerCallback("fail",this._error("invalid_credential","credential_is_undefined"));return}if(!c.call(a,n)){this._innerCallback("fail",this._error("invalid_charge","no_such_channel:"+n));return}if(!c.call(o["credential"],n)){this._innerCallback("fail",this._error("invalid_credential","no_valid_channel_credential"));return}if(!c.call(o,"livemode")){this._innerCallback("fail",this._error("invalid_charge","no_livemode"));return}if(o["livemode"]==false){this._testModeNotify(o);return}var p=o["credential"][n];if(n==a.upmp_wap){location.href=b.UPMP_WAP_URL+p["paydata"]}else{if(n==a.upacp_wap){e(b.UPACP_WAP_URL,"post",p)}else{if(n==a.alipay_wap){p["_input_charset"]="utf-8";if(typeof _AP!="undefined"){var q=g(p,n,true);_AP.pay(b.ALIPAY_WAP_URL+"?"+q)}else{e(b.ALIPAY_WAP_URL,"get",p)}}else{if(n==a.bfb_wap){if(!c.call(p,"url")){this._innerCallback("fail",this._error("invalid_credential","missing_field:url"));return}location.href=p["url"]+"?"+g(p,n)}else{if(n==a.yeepay_wap){var m=["merchantaccount","encryptkey","data"];for(var j in m){if(typeof m[j]!=="function"&&!c.call(p,m[j])){this._innerCallback("fail",this._error("invalid_credential","missing_field_"+m[j]));return}}if(c.call(p,"mode")&&p["mode"]=="test"){location.href=b.YEEPAY_WAP_TEST_URL+"?"+g(p,n,true)}else{location.href=b.YEEPAY_WAP_URL+"?"+g(p,n,true)}}else{if(n==a.wx_pub){var m=["appId","timeStamp","nonceStr","package","signType","paySign"];for(var j in m){if(typeof m[j]!=="function"&&!c.call(p,m[j])){this._innerCallback("fail",this._error("invalid_credential","missing_field_"+m[j]));return}}this._jsApiParameters=p;this._callpay()}else{if(n==a.jdpay_wap){e(b.JDPAY_WAP_URL,"post",p)}}}}}}}},_jsApiCall:function(){var h=this;if(h._jsApiParameters!={}){WeixinJSBridge.invoke("getBrandWCPayRequest",h._jsApiParameters,function(i){if(i.err_msg=="get_brand_wcpay_request:ok"){h._innerCallback("success")}else{if(i.err_msg=="get_brand_wcpay_request:cancel"){h._innerCallback("cancel")}else{h._innerCallback("fail",h._error("wx_result_fail",i.err_msg))}}})}},_callpay:function(){var h=this;if(typeof wx!="undefined"&&typeof h._signature!="undefined"){var i=false;wx.config({debug:h._debug,appId:h._jsApiParameters["appId"],timestamp:h._jsApiParameters["timeStamp"],nonceStr:h._jsApiParameters["nonceStr"],signature:h._signature,jsApiList:["chooseWXPay"]});wx.ready(function(){if(i){return}wx.chooseWXPay({timestamp:h._jsApiParameters["timeStamp"],nonceStr:h._jsApiParameters["nonceStr"],"package":h._jsApiParameters["package"],signType:h._jsApiParameters["signType"],paySign:h._jsApiParameters["paySign"],success:function(k){if(k.errMsg=="chooseWXPay:ok"){h._innerCallback("success")}else{h._innerCallback("fail",h._error("wx_result_fail",k.errMsg))}},cancel:function(k){h._innerCallback("cancel")},fail:function(k){h._innerCallback("fail",h._error("wx_result_fail",k.errMsg))}})});wx.error(function(k){i=true;h._innerCallback("fail",h._error("wx_config_error",k.errMsg))})}else{if(typeof WeixinJSBridge=="undefined"){function j(){h._jsApiCall()}if(document.addEventListener){document.addEventListener("WeixinJSBridgeReady",j,false)}else{if(document.attachEvent){document.attachEvent("WeixinJSBridgeReady",j);document.attachEvent("onWeixinJSBridgeReady",j)}}}else{this._jsApiCall()}}},_error:function(i,h){i=(typeof i=="undefined")?"":i;h=(typeof h=="undefined")?"":h;return{msg:i,extra:h}},_innerCallback:function(h,i){if(typeof this._resultCallback=="function"){if(typeof i=="undefined"){i=this._error()}this._resultCallback(h,i)}},_testModeNotify:function(j){var i=this;if(j["channel"]==a.wx_pub){var h=confirm("模拟付款？");if(h){var k=new XMLHttpRequest();k.open("GET",b.PINGPP_NOTIFY_URL+j["id"]+"?livemode=false",true);k.onload=function(){if(k.status>=200&&k.status<400&&k.responseText=="success"){i._innerCallback("success")}else{var m="http_code:"+k.status+";response:"+k.responseText;i._innerCallback("fail",i._error("testmode_notify_fail",m))}};k.onerror=function(){i._innerCallback("fail",i._error("network_err"))};k.send()}else{i._innerCallback("cancel")}}else{var l={"ch_id":j["id"],"scheme":"http","channel":j["channel"]};if(c.call(j,"order_no")){l["order_no"]=j["order_no"]}if(c.call(j,"extra")){l["extra"]=encodeURIComponent(JSON.stringify(j["extra"]))}location.href=b.PINGPP_MOCK_URL+"?"+g(l)}}};function e(i,m,l){var k=document.createElement("form");k.setAttribute("method",m);k.setAttribute("action",i);for(var j in l){if(c.call(l,j)){var h=document.createElement("input");h.setAttribute("type","hidden");h.setAttribute("name",j);h.setAttribute("value",l[j]);k.appendChild(h)}}document.body.appendChild(k);k.submit()}function g(m,l,j){if(typeof j=="undefined"){j=false}var h=[];for(var k in m){if(l=="bfb_wap"&&k=="url"){continue}if(l=="yeepay_wap"&&k=="mode"){continue}h.push(k+"="+(j?encodeURIComponent(m[k]):m[k]))}return h.join("&")}f.prototype.payment=f.prototype.createPayment;window.pingpp=new f();window.PINGPP_PAY_SDK=window.PINGPP_WX_PUB=window.pingpp})();!function(a,b){"function"==typeof define&&(define.amd||define.cmd)?define(function(){return b(a)}):b(a,!0)}(this,function(a,b){function c(b,c,d){a.WeixinJSBridge?WeixinJSBridge.invoke(b,e(c),function(a){g(b,a,d)}):j(b,d)}function d(b,c,d){a.WeixinJSBridge?WeixinJSBridge.on(b,function(a){d&&d.trigger&&d.trigger(a),g(b,a,c)}):d?j(b,d):j(b,c)}function e(a){return a=a||{},a.appId=z.appId,a.verifyAppId=z.appId,a.verifySignType="sha1",a.verifyTimestamp=z.timestamp+"",a.verifyNonceStr=z.nonceStr,a.verifySignature=z.signature,a}function f(a){return{timeStamp:a.timestamp+"",nonceStr:a.nonceStr,"package":a.package,paySign:a.paySign,signType:a.signType||"SHA1"}}function g(a,b,c){var d,e,f;switch(delete b.err_code,delete b.err_desc,delete b.err_detail,d=b.errMsg,d||(d=b.err_msg,delete b.err_msg,d=h(a,d),b.errMsg=d),c=c||{},c._complete&&(c._complete(b),delete c._complete),d=b.errMsg||"",z.debug&&!c.isInnerInvoke&&alert(JSON.stringify(b)),e=d.indexOf(":"),f=d.substring(e+1)){case"ok":c.success&&c.success(b);break;case"cancel":c.cancel&&c.cancel(b);break;default:c.fail&&c.fail(b)}c.complete&&c.complete(b)}function h(a,b){var e,f,c=a,d=p[c];return d&&(c=d),e="ok",b&&(f=b.indexOf(":"),e=b.substring(f+1),"confirm"==e&&(e="ok"),"failed"==e&&(e="fail"),-1!=e.indexOf("failed_")&&(e=e.substring(7)),-1!=e.indexOf("fail_")&&(e=e.substring(5)),e=e.replace(/_/g," "),e=e.toLowerCase(),("access denied"==e||"no permission to execute"==e)&&(e="permission denied"),"config"==c&&"function not exist"==e&&(e="ok"),""==e&&(e="fail")),b=c+":"+e}function i(a){var b,c,d,e;if(a){for(b=0,c=a.length;c>b;++b)d=a[b],e=o[d],e&&(a[b]=e);return a}}function j(a,b){if(!(!z.debug||b&&b.isInnerInvoke)){var c=p[a];c&&(a=c),b&&b._complete&&delete b._complete,console.log('"'+a+'",',b||"")}}function k(){if(!("6.0.2">w||y.systemType<0)){var b=new Image;y.appId=z.appId,y.initTime=x.initEndTime-x.initStartTime,y.preVerifyTime=x.preVerifyEndTime-x.preVerifyStartTime,C.getNetworkType({isInnerInvoke:!0,success:function(a){y.networkType=a.networkType;var c="https://open.weixin.qq.com/sdk/report?v="+y.version+"&o="+y.isPreVerifyOk+"&s="+y.systemType+"&c="+y.clientVersion+"&a="+y.appId+"&n="+y.networkType+"&i="+y.initTime+"&p="+y.preVerifyTime+"&u="+y.url;b.src=c}})}}function l(){return(new Date).getTime()}function m(b){t&&(a.WeixinJSBridge?b():q.addEventListener&&q.addEventListener("WeixinJSBridgeReady",b,!1))}function n(){C.invoke||(C.invoke=function(b,c,d){a.WeixinJSBridge&&WeixinJSBridge.invoke(b,e(c),d)},C.on=function(b,c){a.WeixinJSBridge&&WeixinJSBridge.on(b,c)})}var o,p,q,r,s,t,u,v,w,x,y,z,A,B,C;if(!a.jWeixin)return o={config:"preVerifyJSAPI",onMenuShareTimeline:"menu:share:timeline",onMenuShareAppMessage:"menu:share:appmessage",onMenuShareQQ:"menu:share:qq",onMenuShareWeibo:"menu:share:weiboApp",onMenuShareQZone:"menu:share:QZone",previewImage:"imagePreview",getLocation:"geoLocation",openProductSpecificView:"openProductViewWithPid",addCard:"batchAddCard",openCard:"batchViewCard",chooseWXPay:"getBrandWCPayRequest"},p=function(){var b,a={};for(b in o)a[o[b]]=b;return a}(),q=a.document,r=q.title,s=navigator.userAgent.toLowerCase(),t=-1!=s.indexOf("micromessenger"),u=-1!=s.indexOf("android"),v=-1!=s.indexOf("iphone")||-1!=s.indexOf("ipad"),w=function(){var a=s.match(/micromessenger\/(\d+\.\d+\.\d+)/)||s.match(/micromessenger\/(\d+\.\d+)/);return a?a[1]:""}(),x={initStartTime:l(),initEndTime:0,preVerifyStartTime:0,preVerifyEndTime:0},y={version:1,appId:"",initTime:0,preVerifyTime:0,networkType:"",isPreVerifyOk:1,systemType:v?1:u?2:-1,clientVersion:w,url:encodeURIComponent(location.href)},z={},A={_completes:[]},B={state:0,res:{}},m(function(){x.initEndTime=l()}),C={config:function(a){z=a,j("config",a);var b=z.check===!1?!1:!0;m(function(){var a,d,e;if(b)c(o.config,{verifyJsApiList:i(z.jsApiList)},function(){A._complete=function(a){x.preVerifyEndTime=l(),B.state=1,B.res=a},A.success=function(){y.isPreVerifyOk=0},A.fail=function(a){A._fail?A._fail(a):B.state=-1};var a=A._completes;return a.push(function(){z.debug||k()}),A.complete=function(){for(var c=0,d=a.length;d>c;++c)a[c]();A._completes=[]},A}()),x.preVerifyStartTime=l();else{for(B.state=1,a=A._completes,d=0,e=a.length;e>d;++d)a[d]();A._completes=[]}}),z.beta&&n()},ready:function(a){0!=B.state?a():(A._completes.push(a),!t&&z.debug&&a())},error:function(a){"6.0.2">w||(-1==B.state?a(B.res):A._fail=a)},checkJsApi:function(a){var b=function(a){var c,d,b=a.checkResult;for(c in b)d=p[c],d&&(b[d]=b[c],delete b[c]);return a};c("checkJsApi",{jsApiList:i(a.jsApiList)},function(){return a._complete=function(a){if(u){var c=a.checkResult;c&&(a.checkResult=JSON.parse(c))}a=b(a)},a}())},onMenuShareTimeline:function(a){d(o.onMenuShareTimeline,{complete:function(){c("shareTimeline",{title:a.title||r,desc:a.title||r,img_url:a.imgUrl||"",link:a.link||location.href,type:a.type||"link",data_url:a.dataUrl||""},a)}},a)},onMenuShareAppMessage:function(a){d(o.onMenuShareAppMessage,{complete:function(){c("sendAppMessage",{title:a.title||r,desc:a.desc||"",link:a.link||location.href,img_url:a.imgUrl||"",type:a.type||"link",data_url:a.dataUrl||""},a)}},a)},onMenuShareQQ:function(a){d(o.onMenuShareQQ,{complete:function(){c("shareQQ",{title:a.title||r,desc:a.desc||"",img_url:a.imgUrl||"",link:a.link||location.href},a)}},a)},onMenuShareWeibo:function(a){d(o.onMenuShareWeibo,{complete:function(){c("shareWeiboApp",{title:a.title||r,desc:a.desc||"",img_url:a.imgUrl||"",link:a.link||location.href},a)}},a)},onMenuShareQZone:function(a){d(o.onMenuShareQZone,{complete:function(){c("shareQZone",{title:a.title||r,desc:a.desc||"",img_url:a.imgUrl||"",link:a.link||location.href},a)}},a)},startRecord:function(a){c("startRecord",{},a)},stopRecord:function(a){c("stopRecord",{},a)},onVoiceRecordEnd:function(a){d("onVoiceRecordEnd",a)},playVoice:function(a){c("playVoice",{localId:a.localId},a)},pauseVoice:function(a){c("pauseVoice",{localId:a.localId},a)},stopVoice:function(a){c("stopVoice",{localId:a.localId},a)},onVoicePlayEnd:function(a){d("onVoicePlayEnd",a)},uploadVoice:function(a){c("uploadVoice",{localId:a.localId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},downloadVoice:function(a){c("downloadVoice",{serverId:a.serverId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},translateVoice:function(a){c("translateVoice",{localId:a.localId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},chooseImage:function(a){c("chooseImage",{scene:"1|2",count:a.count||9,sizeType:a.sizeType||["original","compressed"],sourceType:a.sourceType||["album","camera"]},function(){return a._complete=function(a){if(u){var b=a.localIds;b&&(a.localIds=JSON.parse(b))}},a}())},previewImage:function(a){c(o.previewImage,{current:a.current,urls:a.urls},a)},uploadImage:function(a){c("uploadImage",{localId:a.localId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},downloadImage:function(a){c("downloadImage",{serverId:a.serverId,isShowProgressTips:0==a.isShowProgressTips?0:1},a)},getNetworkType:function(a){var b=function(a){var c,d,e,b=a.errMsg;if(a.errMsg="getNetworkType:ok",c=a.subtype,delete a.subtype,c)a.networkType=c;else switch(d=b.indexOf(":"),e=b.substring(d+1)){case"wifi":case"edge":case"wwan":a.networkType=e;break;default:a.errMsg="getNetworkType:fail"}return a};c("getNetworkType",{},function(){return a._complete=function(a){a=b(a)},a}())},openLocation:function(a){c("openLocation",{latitude:a.latitude,longitude:a.longitude,name:a.name||"",address:a.address||"",scale:a.scale||28,infoUrl:a.infoUrl||""},a)},getLocation:function(a){a=a||{},c(o.getLocation,{type:a.type||"wgs84"},function(){return a._complete=function(a){delete a.type},a}())},hideOptionMenu:function(a){c("hideOptionMenu",{},a)},showOptionMenu:function(a){c("showOptionMenu",{},a)},closeWindow:function(a){a=a||{},c("closeWindow",{immediate_close:a.immediateClose||0},a)},hideMenuItems:function(a){c("hideMenuItems",{menuList:a.menuList},a)},showMenuItems:function(a){c("showMenuItems",{menuList:a.menuList},a)},hideAllNonBaseMenuItem:function(a){c("hideAllNonBaseMenuItem",{},a)},showAllNonBaseMenuItem:function(a){c("showAllNonBaseMenuItem",{},a)},scanQRCode:function(a){a=a||{},c("scanQRCode",{needResult:a.needResult||0,scanType:a.scanType||["qrCode","barCode"]},function(){return a._complete=function(a){var b,c;v&&(b=a.resultStr,b&&(c=JSON.parse(b),a.resultStr=c&&c.scan_code&&c.scan_code.scan_result))},a}())},openProductSpecificView:function(a){c(o.openProductSpecificView,{pid:a.productId,view_type:a.viewType||0,ext_info:a.extInfo},a)},addCard:function(a){var e,f,g,h,b=a.cardList,d=[];for(e=0,f=b.length;f>e;++e)g=b[e],h={card_id:g.cardId,card_ext:g.cardExt},d.push(h);c(o.addCard,{card_list:d},function(){return a._complete=function(a){var c,d,e,b=a.card_list;if(b){for(b=JSON.parse(b),c=0,d=b.length;d>c;++c)e=b[c],e.cardId=e.card_id,e.cardExt=e.card_ext,e.isSuccess=e.is_succ?!0:!1,delete e.card_id,delete e.card_ext,delete e.is_succ;a.cardList=b,delete a.card_list}},a}())},chooseCard:function(a){c("chooseCard",{app_id:z.appId,location_id:a.shopId||"",sign_type:a.signType||"SHA1",card_id:a.cardId||"",card_type:a.cardType||"",card_sign:a.cardSign,time_stamp:a.timestamp+"",nonce_str:a.nonceStr},function(){return a._complete=function(a){a.cardList=a.choose_card_info,delete a.choose_card_info},a}())},openCard:function(a){var e,f,g,h,b=a.cardList,d=[];for(e=0,f=b.length;f>e;++e)g=b[e],h={card_id:g.cardId,code:g.code},d.push(h);c(o.openCard,{card_list:d},a)},chooseWXPay:function(a){c(o.chooseWXPay,f(a),a)}},b&&(a.wx=a.jWeixin=C),C});